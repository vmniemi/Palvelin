x) Lue ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva.)
Karvinen 2018: Pkg-File-Service – Control Daemons with Salt – Change SSH Server Port
- Saltilla voi hallita demoneita Package-file-service:llä. Pitää asentaa softa, vaihtaa konfiguraatio tiedosto ja käynnistää demoni uudestaan.
- Artikkelissa näytettiin Saltin moduuli jolla voi vaihtaa SSH:n palvelimen portin

  

a) Apache easy mode. Asenna Apache, korvaa sen testisivu ja varmista, että demoni käynnistyy.
Ensin käsin, vasta sitten automaattisesti.
Kirjoita tila sls-tiedostoon.
pkg-file-service
Tässä ei tarvita service:ssä watch, koska index.html ei ole asetustiedosto

    sudo apt-get install apache2


![apache1](https://github.com/user-attachments/assets/396d0c18-d982-44fc-be2e-d8bb1ab38a9f)

![apache22](https://github.com/user-attachments/assets/e8224c95-c858-4594-a261-5f7bd782134d)


![apache3](https://github.com/user-attachments/assets/e25ce90e-0b24-44bf-b968-d9e47826dcfc)

![nettisivu](https://github.com/user-attachments/assets/8a77fb3d-a03b-4239-b483-44d96b0bdc94)


![vaihdettunettisivu](https://github.com/user-attachments/assets/415f1282-0809-4e49-b29f-4ca12446fb9a)

![apache2statuskasin](https://github.com/user-attachments/assets/35680f55-f044-4cf9-8a66-1b9e19bca2c5)


Sitten automaattisesti



![aatesti](https://github.com/user-attachments/assets/83b87b94-9676-4cb6-bfff-bb81021bcc45)


![autovaihto](https://github.com/user-attachments/assets/baa8e281-b194-4ffd-8670-710c4ef76ab5)



![autoapacheminion](https://github.com/user-attachments/assets/507c0d2f-ecd1-4fc1-b7fd-eed3f14117e1)



![slsauto](https://github.com/user-attachments/assets/046c9afa-a550-4eb4-90dc-e25185f30073)


![aaapache](https://github.com/user-attachments/assets/6172bd5c-7220-4c9d-8b63-77c53282ba1c)


![cattesti](https://github.com/user-attachments/assets/bcc5e459-6e49-4ef9-9712-8ef2f1eb5066)


![aatarkastus](https://github.com/user-attachments/assets/431ce8d9-db53-497c-9186-5033a55bfc2d)

b) SSHouto. Lisää uusi portti, jossa SSHd kuuntelee.
Jos käytät Vagrantia, muista jättää portti 22/tcp auki - se on oma yhteytesi koneeseen. SSHd:n asetustiedostoon voi tehdä yksinkertaisesti kaksi "Port" riviä, molemmat portit avataan.
Löydät oikean asetuksen katsomalla SSH:n asetustiedostoa
Nyt tarvitaan service-watch, jotta demoni käynnistetään uudelleen, jos asetustiedosto muuttuu masterilla

Käsin 


![käsinsshd1](https://github.com/user-attachments/assets/7f6607d2-b55f-4f29-ab23-dfbcb74de5e2)


![käsinsshd2](https://github.com/user-attachments/assets/81606511-fea1-490e-97b8-40b314a85362)


Itselleni riitti tämä config tiedosto

Include /etc/ssh/sshd_config.d/*.conf

Port 22
Port 8888
AddressFamily any

ListenAddress 0.0.0.0
ListenAddress ::
HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key

Ciphers and keying
RekeyLimit default none

 Logging
SyslogFacility AUTH
LogLevel INFO

 Authentication:

LoginGraceTime 2m
PermitRootLogin prohibit-password
StrictModes yes
MaxAuthTries 6
MaxSessions 10

PubkeyAuthentication yes

 Expect .ssh/authorized_keys2 to be disregarded by default in future.
AuthorizedKeysFile     .ssh/authorized_keys .ssh/authorized_keys2

AuthorizedPrincipalsFile none

AuthorizedKeysCommand none
AuthorizedKeysCommandUser nobody

 For this to work you will also need host keys in /etc/ssh/ssh_known_hosts
HostbasedAuthentication no
#Change to yes if you don't trust ~/.ssh/known_hosts for
 HostbasedAuthentication
IgnoreUserKnownHosts no
 Don't read the user's ~/.rhosts and ~/.shosts files
#gnoreRhosts yes
                                                                 
 HostbasedAuthentication
IgnoreUserKnownHosts no
 Don't read the user's ~/.rhosts and ~/.shosts files
IgnoreRhosts yes

# To disable tunneled clear text passwords, change to no here!
PasswordAuthentication yes
#PermitEmptyPasswords no

Change to yes to enable challenge-response passwords (beware issues with some PAM modules and threads)
KbdInteractiveAuthentication no

 Kerberos options
KerberosAuthentication no
#KerberosOrLocalPasswd yes
#KerberosTicketCleanup yes
#KerberosGetAFSToken no

 GSSAPI options
GSSAPIAuthentication no
GSSAPICleanupCredentials yes
#GSSAPIStrictAcceptorCheck yes
GSSAPIKeyExchange no


PermitRootLogin prohibit-password
UsePAM yes


Sitten automatisaatio


Tein  masterin srv/salt hakemistoon ssh kansion 

Menin 

    sudoedit sshd.sls

  
openssh serverin asennus

  
  
    openssh-server:
     pkg.installed


 Määritin sijainnin jonne sshd config tiedosto menee
 
    /etc/ssh/sshd_config:
     file.managed:
        - source: salt://sshd_config

 

     
    sshd:
     service.running:
       - watch:
        - file: /etc/ssh/sshd_config

        

![autosshdsls](https://github.com/user-attachments/assets/3888153a-cb82-44c6-9301-9863bec15aa6)



Sitten loin it se sshd_config tiedoston ja käytin samaa kuin edellisessä käsin tehdyssä vaiheessa



Tuli ongelma kun yritin kutsua komennolla 

    sudo salt '*' state.apply ssh.sshd


Se ei osannut löytää sshd_config tiedostoa (tai näin arvelin)

![sshdprob1](https://github.com/user-attachments/assets/160aecc0-a28d-42da-8ce6-0f8684c19614)



Tällä oletuksella koetin löytää sen käyttämällä komentoa 

    ls -l /srv/salt/ssh/sshd_config


Ja minun onnekseni sitä ei ollut siellä


Joten kopioin sen kohteesta, josta tiesin että sen on siellä


    sudo cp etc/ssh/sshd_config srv/salt/ssh/sshd_config

    
Tarkastin tilanteen ja se oli nyt siellä
    
    ls -l /srv/salt/ssh/sshd_config



![sshdprob1rat](https://github.com/user-attachments/assets/2734cbef-b1a9-4b46-af05-e31a5992a1e8)


Ajoin uudestaan ja nyt toimii

    sudo salt '*' state.apply ssh.sshd





![sshdprobohi](https://github.com/user-attachments/assets/5ba6a83c-d590-41d2-912e-0c30bca3b285)
